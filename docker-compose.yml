services:
  codespy:
    build: .
    env_file:
      - .env
    environment:
      - GITHUB_TOKEN=${GITHUB_TOKEN}
      - LITELLM_MODEL=${LITELLM_MODEL:-gpt-4o}
      - AWS_REGION=${AWS_REGION:-us-east-1}
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID:-}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY:-}
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
    volumes:
      # Persist cache for cloned repositories
      - codespy-cache:/home/codespy/.cache/codespy
      # Mount AWS credentials if using Bedrock with default credentials
      - ${HOME}/.aws:/home/codespy/.aws:ro
    # Override command to run review (set PR_URL in environment or use docker run)
    # Example: docker compose run codespy review https://github.com/owner/repo/pull/123
    command: ["--help"]

volumes:
  codespy-cache: