# codespy.yaml - Configuration file for codespy
#
# ENVIRONMENT VARIABLE OVERRIDES:
# All settings can be overridden via environment variables.
# - Flat values: <KEY> (e.g., OUTPUT_FORMAT=json, DEFAULT_MODEL=gpt-5)
# - Signature values: <SIGNATURE>_<KEY>
#   Examples:
#     CODE_SECURITY_MAX_ITERS=15
#     CODE_SECURITY_ENABLED=false
#     SUPPLY_CHAIN_MODEL=gpt-4-turbo
#     BUG_DETECTION_MAX_ITERS=10
#
# Priority: Environment Variables > YAML Config > Defaults

# ============================================================================
# LLM ACCESS
# ============================================================================
llm:
  # OpenAI
  openai_api_key: null                   # OPENAI_API_KEY
  openai_api_base: null                  # OPENAI_API_BASE
  auto_discover_openai: true             # AUTO_DISCOVER_OPENAI (set to false to disable)

  # Anthropic
  anthropic_api_key: null                # ANTHROPIC_API_KEY
  auto_discover_anthropic: true          # AUTO_DISCOVER_ANTHROPIC (set to false to disable)

  # Google Gemini
  gemini_api_key: null                   # GEMINI_API_KEY
  auto_discover_gemini: true             # AUTO_DISCOVER_GEMINI (set to false to disable)

  # AWS Bedrock
  aws_region: us-east-1                  # AWS_REGION
  aws_access_key_id: null                # AWS_ACCESS_KEY_ID
  aws_secret_access_key: null            # AWS_SECRET_ACCESS_KEY
  aws_profile: null                      # AWS_PROFILE
  auto_discover_aws: true                # AUTO_DISCOVER_AWS (set to false to disable)

  # Azure OpenAI
  azure_api_key: null                    # AZURE_API_KEY
  azure_api_base: null                   # AZURE_API_BASE
  azure_api_version: null                # AZURE_API_VERSION

  # Enable provider-side prompt caching (Anthropic, OpenAI, Bedrock, etc.)
  # Caches system prompts on the LLM provider's servers to reduce latency and costs
  enable_prompt_caching: true              # ENABLE_PROMPT_CACHING


# ============================================================================
# GIT PLATFORMS
# ============================================================================
github:
  token: null                            # GITHUB_TOKEN (auto-discovered if not set)
  auto_discover_token: true              # GITHUB_AUTO_DISCOVER_TOKEN (set to false to disable auto-discovery)

gitlab:
  token: null                            # GITLAB_TOKEN (auto-discovered if not set)
  url: https://gitlab.com                # GITLAB_URL (for self-hosted instances)
  auto_discover_token: true              # GITLAB_AUTO_DISCOVER_TOKEN (set to false to disable auto-discovery)

# ============================================================================
# SIGNATURES
# ============================================================================
# Each signature config supports: enabled, max_iters, model, max_context_size
# Set to null to use defaults

# These apply to all signatures unless overridden per-signature
default_model: claude-opus-4-6                  # DEFAULT_MODEL (Haiku 4.5 - default)
extraction_model: claude-sonnet-4-5-20250929    # EXTRACTION_MODEL (for TwoStepAdapter field extraction)
default_max_iters: 10                           # DEFAULT_MAX_ITERS
default_max_context_size: 50000                 # DEFAULT_MAX_CONTEXT_SIZE
default_max_reasoning_tokens: 4000              # DEFAULT_MAX_REASONING_TOKENS (limits LLM reasoning verbosity)
default_temperature: 0                          # DEFAULT_TEMPERATURE (lower = more deterministic output)

# Global LLM reliability settings
llm_retries: 3                           # LLM_RETRIES (number of retries for LLM API calls)
llm_timeout: 120                         # LLM_TIMEOUT (timeout in seconds for LLM calls)

signatures:
  # Security Auditor signatures
  code_security:
    enabled: true                        # CODE_SECURITY_ENABLED
    max_iters: null                      # CODE_SECURITY_MAX_ITERS
    model: null                          # CODE_SECURITY_MODEL (Haiku 4.5)
    max_context_size: null               # CODE_SECURITY_MAX_CONTEXT_SIZE
    max_reasoning_tokens: null           # CODE_SECURITY_MAX_REASONING_TOKENS
    temperature: null                    # CODE_SECURITY_TEMPERATURE

  supply_chain:
    enabled: true                        # SUPPLY_CHAIN_ENABLED
    max_iters: null                      # SUPPLY_CHAIN_MAX_ITERS
    model: null                          # SUPPLY_CHAIN_MODEL (Haiku 4.5)
    max_context_size: null               # SUPPLY_CHAIN_MAX_CONTEXT_SIZE
    max_reasoning_tokens: null           # SUPPLY_CHAIN_MAX_REASONING_TOKENS
    temperature: null                    # SUPPLY_CHAIN_TEMPERATURE
    scan_unchanged: true                 # SUPPLY_CHAIN_SCAN_UNCHANGED
    # When true (default): scans ALL artifacts (Dockerfiles, etc.) and manifests
    # When false: only scans artifacts/manifests that were modified in the MR

  # Bug Detector signature
  bug_detection:
    enabled: true                        # BUG_DETECTION_ENABLED
    max_iters: null                      # BUG_DETECTION_MAX_ITERS
    model: null                          # BUG_DETECTION_MODEL (Haiku 4.5)
    max_context_size: null               # BUG_DETECTION_MAX_CONTEXT_SIZE
    max_reasoning_tokens: null           # BUG_DETECTION_MAX_REASONING_TOKENS
    temperature: null                    # BUG_DETECTION_TEMPERATURE

  # Doc Reviewer signature
  doc_review:
    enabled: true                        # DOC_REVIEW_ENABLED
    max_iters: null                      # DOC_REVIEW_MAX_ITERS
    model: null                          # DOC_REVIEW_MODEL (Sonnet 4.5)
    max_context_size: null               # DOC_REVIEW_MAX_CONTEXT_SIZE
    max_reasoning_tokens: null           # DOC_REVIEW_MAX_REASONING_TOKENS
    temperature: null                    # DOC_REVIEW_TEMPERATURE

  # Domain Expert signature
  domain_analysis:
    enabled: false                       # DOMAIN_ANALYSIS_ENABLED
    max_iters: null                      # DOMAIN_ANALYSIS_MAX_ITERS
    model: null                          # DOMAIN_ANALYSIS_MODEL (Haiku 4.5)
    max_context_size: null               # DOMAIN_ANALYSIS_MAX_CONTEXT_SIZE
    max_reasoning_tokens: null           # DOMAIN_ANALYSIS_MAX_REASONING_TOKENS
    temperature: null                    # DOMAIN_ANALYSIS_TEMPERATURE

  # Scope Identifier signature
  scope_identification:
    enabled: true                        # SCOPE_IDENTIFICATION_ENABLED
    max_iters: null                      # SCOPE_IDENTIFICATION_MAX_ITERS
    model: null                          # SCOPE_IDENTIFICATION_MODEL (Sonnet 4.5)
    max_context_size: null               # SCOPE_IDENTIFICATION_MAX_CONTEXT_SIZE
    max_reasoning_tokens: null           # SCOPE_IDENTIFICATION_MAX_REASONING_TOKENS
    temperature: null                    # SCOPE_IDENTIFICATION_TEMPERATURE

  # Deduplicator signature
  deduplication:
    enabled: true                        # DEDUPLICATION_ENABLED
    model: claude-sonnet-4-5-20250929    # DEDUPLICATION_MODEL (smallest)
    max_context_size: null               # DEDUPLICATION_MAX_CONTEXT_SIZE
    max_reasoning_tokens: null           # DEDUPLICATION_MAX_REASONING_TOKENS
    temperature: null                    # DEDUPLICATION_TEMPERATURE

  # Summarizer signature
  summarization:
    enabled: true                        # SUMMARIZATION_ENABLED
    model: claude-haiku-4-5-20251001     # SUMMARIZATION_MODEL (smallest)
    max_context_size: null               # SUMMARIZATION_MAX_CONTEXT_SIZE
    max_reasoning_tokens: null           # SUMMARIZATION_MAX_REASONING_TOKENS
    temperature: null                    # SUMMARIZATION_TEMPERATURE

# ============================================================================
# OUTPUT
# ============================================================================
output_format: markdown                  # OUTPUT_FORMAT (markdown | json)
output_stdout: true                      # OUTPUT_STDOUT (enable stdout output)
output_git: false                         # OUTPUT_GIT (post review to GitHub PR or GitLab MR)
cache_dir: ~/.cache/codespy              # CACHE_DIR

# ============================================================================
# FILE EXCLUSIONS
# ============================================================================
# Directories to skip during code review (binary files, lock files, and
# minified files are always excluded automatically)
excluded_directories:                    # EXCLUDED_DIRECTORIES (JSON array in env)
  # Vendor/dependency directories
  - vendor
  - node_modules
  - third_party
  - external
  - deps
  - _vendor
  - vendored
  # Build output directories
  - dist
  - build
  - out
  - target
  # Package manager directories
  - .bundle
  - Pods
  - Carthage
  - bower_components
  - jspm_packages
  # Version control
  - .git
  - .svn
  - .hg
  # Cache directories
  - __pycache__
  - .cache
  - .pytest_cache
  - .mypy_cache
  - .ruff_cache
